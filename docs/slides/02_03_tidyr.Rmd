---
subtitle: "Introduction to R - Day "
author: "Selina Baldauf"
institute: "Freie UniversitÃ¤t Berlin - Theoretical Ecology"
date: "2021-08-01"
output:
  xaringan::moon_reader:
    seal: false
    css: [default, css/new_slides.css]
    nature:
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: false
      beforeInit: "macros.js"
params:
  title: "Tidy your data using tidyr"
  day: "2"
  bg_image: "img/hex-stickers/tidyr.png"
  bg_image_scale: "30%"
  bg_position: "90% 90%"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE)
library(tibble)
library(tidyr)
```

```{r child="title_slide.Rmd"}

```

---
class: inverse, center, middle

# .large[What is tidy data?]

---
# What is tidy data?

.center[![:scale 80%](img/AllisonHorst/tidydata_1.jpg)]

.footnote-right[Illustration from the [Openscapes](https://www.openscapes.org/) blog [*Tidy Data for reproducibility, efficiency, and collaboration*](https://www.openscapes.org/blog/2020/10/12/tidy-data/) by Julia Lowndes and Allison Horst]

---
# What is tidy data?

Let's look at some examples

.pull-left[

.center[**Tidy**
```{r echo=FALSE}
data.frame(id = 1:6,
           name = c("floof", "max", "cat", "donut", "merlin", "panda"),
           color = c("gray", "black", "orange", "gray", "black", "calico")) |> 
  knitr::kable()
```
]
]

--

.pull-right[
.center[**Non-tidy**
```{r echo=FALSE}
data.frame(floof = "gray",
           max = "black",
           cat = "orange",
           donut = "gray",
           merlin = "black",
           panda = "calico") |> 
  knitr::kable()
```  

<br>
```{r echo=FALSE}
data.frame(gray = c("floof", "donut"),
           black = c("max", "merlin"),
           orange = c("cat", ""),
           calico = c("panda", "")) |> 
  knitr::kable()
```  
]
]
--
<br><br>
Sometimes ***raw data*** is non-tidy because its structure is optimized for data entry or viewing rather than analysis.

---
# Why tidy data?

The main advantages of **tidy** data is that the `tidyverse` packages are built to work with it.


.center[![:scale 70%](img/AllisonHorst/tidydata_3.jpg)]



.footnote-right[Illustration from the [Openscapes](https://www.openscapes.org/) blog [*Tidy Data for reproducibility, efficiency, and collaboration*](https://www.openscapes.org/blog/2020/10/12/tidy-data/) by Julia Lowndes and Allison Horst]

---
# Example

Let's go back to the city data set from earlier:


```{r echo=FALSE}
cities_v <- c("Istanbul", "Moscow", "London", "Saint Petersburg", "Berlin", "Madrid", "Kyiv", "Rome", "Bucharest", "Paris")
population <- c(15.1e6, 12.5e6, 9e6, 5.4e6, 3.8e6, 3.2e6, 3e6, 2.8e6, 2.2e6, 2.1e6)
area_km2 <- c(2576, 2561, 1572, 1439,891,604, 839, 1285, 228, 105 )

country <- c("Turkey", "Russia", "UK", "Russia", "Germany", "Spain",
                        "Ukraine", "Italy", "Romania", "France")
# tidy
cities_tbl <- tibble(city = cities_v,
           population = population,
           area_km2 = area_km2,
           country = country)
```

```{r}
cities_tbl
```

--

This already looks pretty tidy.

---
# Same data different format

```{r eval=FALSE}
cities_untidy
```


```{r echo=FALSE}
cities_untidy <- unite(cities_tbl, col = "location", c("country", "city")) %>%
  pivot_longer(c("population", "area_km2"), names_to = "type") %>%
  pivot_wider(names_from = "location", values_from = "value")
print(cities_untidy, width = 90)
```

**What's not tidy here?**
--
<br>
- Each row has multiple observation

--

- At the same time, each observation is split across multiple rows

--

- Country and city variable are split into multiple columns

--

- Country and city variable values are united to one value

--

Let's tidy this data using functions from the `tidyr` package!

---
# `pivot_longer()`

**One variable split into multiple column**s can be solved with `pivot_longer`

```{r echo=FALSE}
print(cities_untidy, width = 90)
```

--

```{r}
step1 <- pivot_longer(
    cities_untidy,                         # the tibble
    cols = Turkey_Istanbul:France_Paris,   # the columns to pivot from:to
    names_to = "location",                 # name of the new column
    values_to = "value")                   # name of the value column
```

--

```{r echo=FALSE}
print(step1, n=4)
```

---
# `pivot_longer()`

**One variable split into multiple column**s can be solved with `pivot_longer`

Another way to select the columns to pivot:

```{r}
step1 <- pivot_longer(
    cities_untidy,           # the tibble
    cols = !type,            # All columns except type#<<        
    names_to = "location",   # name of the new column
    values_to = "value")     # name of the value column
```

```{r echo=FALSE}
print(step1, n=4)
```

---
# `separate()`

**Multiple variable values that are united into one** can be separated using `separate`

```{r echo=FALSE}
print(step1,n=2)
```

--

```{r}
step2 <- separate(
  step1,                       # the tibble
  location,                    # the column to separate
  sep = "_",                   # the separator
  into = c("country", "city")) # names of new columns
```

--

```{r echo=FALSE}
print(step2, n=2)
```

--

The opposite function exists as well and is called `unite`. Check out `?unite` for details.

---
# `pivot_wider()`

**One observation split into multiple rows** can solved with `pivot_wider`

```{r echo=FALSE}
print(step2,n=2)
```

--

```{r}
step3 <- pivot_wider(
  step2,                      # the tibble
  names_from = type,          # the variables
  values_from = value)        # the values
```

--

```{r echo=FALSE}
print(step3, n=5)
```

---
# All steps in 1

We can also use a pipe to do all these steps in one:

```{r}
cities_tidy <- cities_untidy %>%
  pivot_longer(Turkey_Istanbul:France_Paris,
               names_to = "location", 
               values_to = "values") %>%
  separate(location, 
           sep = "_", 
           into = c("country", "city")) %>%
  pivot_wider(names_from = type, 
              values_from = values)
```

---
class: inverse, middle, center

# .large[Now you]

## Task 3: Tidying data (45 min)

#### Find the task description <a href="../02_tasks_controller.html#tidyr">here</a>
