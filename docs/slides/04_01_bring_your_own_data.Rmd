---
subtitle: "Introduction to R - Day "
author: "Selina Baldauf"
institute: "Freie Universität Berlin - Theoretical Ecology"
date: "2021-08-01"
output:
  xaringan::moon_reader:
    seal: false
    css: [default, css/new_slides.css]
    nature:
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: false
      beforeInit: "macros.js"
---
# Organization: Schedule

**Schedule of today**

- **Now - 14** (or 14.30 if you are enthusiastic still): Work on the data set
  - Take break(s) as best fits your needs
  
- **14 (14.30) - 15**: Short feedback round

  - What did you find out about your data set? Plots, summaries, ...
  - Which methods did you use?
  - Did you learn something new?
  - Was there something you struggled with?
  - ...
  
- **15-16**: Feedback, conclusion

---
# Data set 1: What makes a good wine?

**Physicochemical properties of wine and quality judgements by "experts"**

```{r echo=FALSE}
str(EcoData::wine)
```

Reference: P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis.
Modeling wine preferences by data mining from physicochemical properties. In Decision Support Systems, Elsevier, 47(4):547-553, 2009.

---
# Data set 1: What makes a good wine?

.pull-left[

**Ideas:**

- Which chemical properties are associated with a good wine rating?
- Plot chemical properties against each other
- Plot quality judgement depending on different properties
- Linear models for the relationship between properties
- Summary tables of the data using `dplyr`

Hint: It might be a good idea to transform the quality column to a factor (use `dplyr::mutate` and `as.factor()` if you want to do this).

]

.pull-right[
![](img/wine.jpg)
.footnote-right[.small[By Frederik Vandaele - originally posted to Flickr as Château Pétrus, CC BY 2.0, https://commons.wikimedia.org/w/index.php?curid=5145286]]]

---
# Data set 2: Paralympic games from 1980-2016

|variable |class     |description |
|:--------|:---------|:-----------|
|gender   |character | Binary gender |
|event    |character | Event name |
|medal    |character | Medal type |
|athlete  |character | Athlete name (LAST NAME first name|
|abb      |character | Country abbreviation |
|country  |character | Country name |
|grp_id   |integer   | Group ID as a count within team sports |
|type     |character | Type of sport |
|year     |double    | year of games |
|guide    |character | Guide (for vision impaired athletes) |
|pilot    |character | Pilot (for vision impaired athletes) |

Source: [International Paralympic Committee](https://db.ipc-services.org/sdms/hira/web/index) (provided by [tidytuesday](https://github.com/rfordatascience/tidytuesday/edit/master/data/2021/2021-08-03/readme.md))


---
# Data set 2: Paralympic games from 1980-2016

Get the data:

```{r eval=FALSE}
athletes <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-08-03/athletes.csv')
```

**Ideas**

- Probably dplyr heavy task
- Create summaries of medal counts for different groups
- Explores questions such as:
  - Did the ratio of men/women winning medals change over time?
  - Which countries were the most successful ones? Does this differ between sports type?
  - Which types of sports accumulated the most medals?
- Plots: e.g. heat map showing the number of medals by medal type and sport/country/gender...

---
# Data set 3: Crab data set

.pull-left[

**Atlantic marsh fiddler crab (*Minuca pugnax*)**

- Crab from Florida is expanding northward due to ocean warming
- Data on 13 marshes across a range of latitude in the USA
- Recording of the size of of the crab

**Ideas for data**

- Rather small and good to handle
- Explore Bergmann's rule (organisms are large in higher latitudes)
- Linear model to explore relationship between latitude and body size
- Anova or tests to compare size between locations
- Plot relationship between latitude and size 
- ...

]

.pull-right[

.center[![](img/day4/lter.jpg)]

.small[Source: [Johnson, D. 2019.](https://doi.org/10.6073/pasta/4c27d2e778d3325d3830a5142e3839bb) Fiddler crab body size in salt marshes from Florida to Massachusetts, USA at PIE and VCR LTER and NOAA NERR sites during summer 2016. ver 1. Environmental Data Initiative.]

]



.footnote-right[.small[Image under CC BY-SA 4.0]]

---
# Data set 3: Crab data set

```{r echo = FALSE}
library(lterdatasampler)
head(pie_crab)
```



.small[Source: [Johnson, D. 2019.](https://doi.org/10.6073/pasta/4c27d2e778d3325d3830a5142e3839bb) Fiddler crab body size in salt marshes from Florida to Massachusetts, USA at PIE and VCR LTER and NOAA NERR sites during summer 2016. ver 1. Environmental Data Initiative.]


.footnote-right[.small[Image by LTER under CC BY-SA 4.0]]

---
# Data set 4: Ice cover and temperature

.pull-left[
**Temperature and ice duration on lakes since 19th century**

- 2 data sets that can be combined
- measurements of
  - ice start, end and duration on 2 lakes in Wisconsin
  - daily air temperature since 1870
]
.pull-right[

![](img/day4/ice.jpg)

]

.footnote-right[.small[Image by LTER under CC BY-SA 4.0]]

.small[

Source ice data: [Magnuson, J.J., S.R. Carpenter, and E.H. Stanley. 2021.](https://doi.org/10.6073/pasta/ab31f2489ee436beb73fc8f1d0213d97) North Temperate Lakes LTER: Ice Duration - Madison Lakes Area 1853 - current ver 35. Environmental Data Initiative. 

Source temperature data: [Anderson, L. and D. Robertson. 2020.](https://doi.org/10.6073/pasta/e3ff85971d817e9898bb8a83fb4c3a8b) Madison Wisconsin Daily Meteorological Data 1869 - current ver 32. Environmental Data Initiative.
]

---
# Data set 4: Ice cover and temperature

.pull-left[
**Ideas**

- How did ice cover duration change over the years?
  - Plotting of the time series
  - Linear model to test effect
- How did air temperature change over the years?
  - Summarizing mean annual temperatur or mean temperature in winter
  - Linear model to test the effect
- Combine the two data sets together
  - How do ice duration on the lakes correlate with temperure (e.g. with mean winter 
  temperature)

]
.pull-right[

![](img/day4/ice.jpg)]

.footnote-right[.small[Image by LTER under CC BY-SA 4.0]]

---
# Data set 4: Ice cover and temperature

Ice data:

```{r echo = FALSE}
#library(lterdatasampler)
head(ntl_icecover)
```

Temperature data:

```{r echo=FALSE}
head(ntl_airtemp)
```

---
# Some general tips

- First make a plan:

  - What do you want to achieve and what are the steps?
  - Try to think in technical terms

--

- Start with something small, e.g. reading in the data and bringing it into the right format.

--

- Google

--

- If you get stuck, ask in the chat or stop by in General


- Have a look at the cheat sheets [(list of all cheat sheets)](https://www.rstudio.com/resources/cheatsheets/)
  - [ggplot2](https://raw.githubusercontent.com/rstudio/cheatsheets/master/data-visualization-2.1.pdf)
  - [dplyr](https://raw.githubusercontent.com/rstudio/cheatsheets/master/data-transformation.pdf)
  - [Data import cheat sheet](https://raw.githubusercontent.com/rstudio/cheatsheets/master/data-import.pdf): readr and tidyr cheat sheet


---
# Read data from Excel (xlsx format)

Use the `read_xlsx()` function from the `readxl` package.

Read a single excel file:

```{r eval=FALSE}
# install.packages("readxl")
library(readxl)

# by default: reads the first sheet
my_data <- read_xlsx(path = "data/my_datafile1.xlsx")

# To read a specific sheet:
# refer to the sheet by its name
my_data <- read_xlsx(path = "data/my_datafile1.xlsx", sheet = "sheet1")
# or refer to it by its id
my_data <- read_xlsx(path = "data/my_datafile1.xlsx", sheet = 2)
```

--

- `read_xlsx` has similar options as `read_csv`, e.g. to skip rows etc.
- have a look at `?read_xlsx` to see all options

---
# Read data from Excel (xlsx format)

If you data is **split into multiple excel sheets** (i.e. one excel file but multiple sheets) you can:

- read in all the excel sheets at once into a list
- use `bind_rows` to bind all the sheets together by row
- This requires all sheets to have the same format and columns

--

```{r eval=FALSE}
# create a variable with the path to the file you want to read
path_to_file <- "data/my_datafile1.xlsx"

# list all the sheets that exist in this file
sheets <- excel_sheets(path_to_file)

# use lapply to read all sheets into a list using read_xlsx
all_sheets <- lapply(sheets, function(x) read_xlsx(path_to_file, sheet = x))

# bind all rows from the list together
my_data <- do.call(bind_rows, all_sheets) # without id column
my_data <- do.call(bind_rows, list(all_sheets, .id = "sheet_id")) # with id column
```

---
# Read data from Excel (xlsx format)

If you data is **split into multiple excel files** (i.e. multiple excel files but one sheet per file) you can:


- read in all the excel files at once into a list
- use `bind_rows` to bind all the files together by row
- This requires all files to have the same format and columns
- My code requires the files to all be in the same folder

--

```{r eval=FALSE}
# List all xlsx files at a given location
# this code will read in all xlsx files at the given location
# if you don't want this, you have to adjust the `pattern`
file_paths <- list.files(path = "./data", pattern = ".xlsx", full.names = TRUE)
# check if this actually list your desired files
file_paths

# use lapply to read all files into a list using read_xlsx
all_files <- lapply(file_paths, read_xlsx)

# bind all rows from the list together
my_data <- do.call(bind_rows, all_files) # without id column
my_data <- do.call(bind_rows, list(all_files, .id = "file_id")) # with id column
```

---
class: inverse, middle, center

# .large[Now You: Working on your own research data]

#### - Meet in your group (if you want)
#### - Start working on a data set
#### - Take breaks as you need and be back at 14:00
#### - Keep an eye on your group and the general chat

 
---
class: inverse, middle, center

# .large[Now You: Working on a data set from me]

#### - Think about the data set you would like to work on 
#### - Build groups
#### - Meet in your group
#### - Start working on a data set
#### - Take breaks as you need and be back at 14:00
#### - Keep an eye on your group and the general chat

---
# Presentation/Feedback round

- What did you find out about your data set? Plots, summaries, ...

- Which methods did you use?

- Did you learn something new?

- Was there something you struggled with?

- If you have a plot or a result to share, please post a screenshot in the chat or share your screen.

---
# Feedback

Please take 5 mins to complete the feedback survey for the Graduate center (don't use Internet Explorer)

.center[https://votingo.cedis.fu-berlin.de/survey/PCNLP3]

--

Please take another 5 mins to complete my more specific survey to further improve the course


.center[https://forms.gle/xfwKLDDomwoY44i66]

---
# Feedback


- Any other feedback or comments from your side?

---
# Workshop: Reproducible documents with Rmarkdown

 
  .center[**Tuesday 13.09. - Wednesday 14.09. ( + Thursday 15.09. optional)** <br> **1 p.m. - 5 p.m.** <br>
  Write an email to [me](mailto:selina.baldauf@fu-berlin.de) or to [Simone](graduate-center@bcp.fu-berlin.de) if you want to join]
  
  .center[![:scale 60%](img/day4/rmarkdown_wizards.png)]

.footnote-right[Artwork by [Allison Horst](https://twitter.com/allison_horst)]


---
# Conclusion

![](img/day1/datascience_workflow_tidyverse.png)

We learned a lot of stuff!

---
# Conclusion

#### How to continue from here?

.pull-left[

- Learning by doing!
- Have a look at some [online ressoures](https://selinazitrone.github.io/intro-r-data-analysis/online_resources.html), I recommend the R for Data Science book by Hadley Wickham
- If you use Twitter: Follow some people that post R content regarding your interest
- If you like plotting: Consider participating in the [tidytuesday](https://github.com/rfordatascience/tidytuesday)
- [FU statistical consulting](http://www.stat.fu-berlin.de/en/dienstleistungen/index.html) for questions regarding statistical methods
]

.pull-right[

![](img/AllisonHorst/r_rollercoaster.png)
]

.footnote-right[Artwork by [Allison Horst](https://twitter.com/allison_horst)]

---
class: inverse, middle, center

# .large[The End]
## Thanks a lot for participating!

![](img/AllisonHorst/heartyr.gif)

.footnote-right[Artwork by [Allison Horst](https://twitter.com/allison_horst)]
