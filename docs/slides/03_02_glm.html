<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>03_02_glm.knit</title>
    <meta charset="utf-8" />
    <meta name="author" content="Selina Baldauf" />
    <meta name="date" content="2021-06-15" />
    <script src="03_02_glm_files/header-attrs-2.9/header-attrs.js"></script>
    <link href="03_02_glm_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/new_slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">





class: inverse title-slide
background-image: url()
background-size: 30%
background-position: 90% 90%

# Generalized linear models with R

## Introduction to R - Day 3

### Instructor: [Selina Baldauf](https://www.bcp.fu-berlin.de/biologie/arbeitsgruppen/botanik/ag_tietjen/People/wissenschaftliche_programmierer/baldauf/index.html) &lt;br&gt;

### Freie Universit√§t Berlin - Theoretical Ecology

.footnote-left[
  2021-06-15 (updated: 2021-07-29)
]
---
# GLMs background

Assumptions of linear models:

- Normal distribution of residuals
  - errors and response not bounded

- Constant variance of residuals
  - no relationship between mean and variance of y
  
--

There are types of data that (generally) violate these assumptions.

---
# GLMs background

**Count data**

- are bounded (cannot be &lt; 0)
- variance increases with the mean&lt;br&gt;
<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> response described by a ***poisson distribution***

--

**Proportion data**

- percentages: bounded between 0 and 1
- variance highest at p = 0.5, lower towards p = 0 and 1&lt;br&gt;
<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> response described by a ***binomial distribution*** (# successes in N trials with probability p)

--

**Binary data**

- Only 0 and 1
- variance highest at p = 0.5, lower towards p = 0 and 1&lt;br&gt;
<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> response described by a ***bernoulli distribution*** (binomial distribution with N=1)

---
# GLMs background

**Components of a GLM**

- Linear predictor `\(\eta_i = \beta_0 + \sum \beta_j * X_{i,j}\)`
  - like a linear model: linear combination of the effects of the predictors `\(X_j\)`

--

- Error structure 
  - non-normal distribution e.g. skewed, bounded, non-negative (e.g. Poisson distribution)
  
--

- Link function `\(g(\mu_i) = \eta_i\)`
  - relates the expected response values `\(\mu_i\)` to the linear predictor
  - A linear model is also a glm with a gaussian link function (identity `=`)
  - predicted values: require inverse link function!

---
# Parameter estimation in GLMS

#### Linear models

- Ordinary Least Squares (OLS)
- Minimizing the residual sum of squares to find parameters
- This method only works if linera model assumptions are not violated

--

#### GLMs

- Maximizing the likelihood (ML)
- **Likelihood:** Probability of the data *given* the model
- **Likelihood function:** How does the likelihood depend on the model parameters? <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> Maximum: ML parameter estimates of the GLM

---
# Binomial distribution

- Frequency distribution of the number of successes of an event with success probability p and N trials.
  - E.g. No of "six" with 10 dice: `\(p = 0.5\)`, `\(N = 10\)`
  
.pull-left[

`\(f(k) = \binom{N}{k} p^k * (1-p)^{N - k}\)`

`\(E(k) = N*p\)`

`\(Var(k) = N*p*(1-p)\)`

with `\(k\)` being the number of "successes"
]
.pull-right[
![](img/day3/binom_plot.png)
]

--

**Bernoulli** distribution as special case with N = 1 (e.g. coin flip).

---
# Binomial and binary GLMs
&lt;br&gt;

- logit link function: `\(logit(p_i) = ln(\frac{p_i}{1-p_i}) = \eta_i\)`

- inverse link function: `\(p_i = \frac{e^{\eta_i}}{1+e^{\eta_i}}\)`

- binomial error distribution: `\(\epsilon \sim B(p_i, N = n)\)`

---
# Poisson distribution

- Frequency distribution of counts of rare events
  - E.g. Bird count in forests
  
.pull-left[

`\(f(k) = \frac{e^{-\lambda}\lambda^k}{k!}\)`

`\(E(k) = \lambda\)`

`\(Var(k) = \lambda\)`

with `\(k\)` being the number of occurrences
]

.pull-right[
![](img/day3/poiss_plot.png)
]

---
# Poisson GLMs
&lt;br&gt;

- log link function: `\(ln(\lambda_i) = \eta_i\)`

- inverse link function: `\(\lambda_i = e^{\eta_i}}\)`

- poisson error distribution: `\(\epsilon \sim P(\lambda_i)\)`

---
class: inverse, middle, center

# GLMs in <svg aria-hidden="true" role="img" viewBox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg>

## Let's look a poisson GLM as example

---
# The data

Data set: Species diversity in plots with different soil pH

.pull-left[

- **Response variable:**
  - number of plant species
- **Predictor variables:**
  - Plot biomass
  - soil pH


```r
specdat
```


```
## # A tibble: 90 x 3
##   pH    Biomass Species
##   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 high    0.469      30
## 2 high    1.73       39
## 3 high    2.09       44
## 4 high    3.93       35
## # ... with 86 more rows
```

]

.pull-right[
&lt;img src="03_02_glm_files/figure-html/unnamed-chunk-4-1.png" width="504" /&gt;
]

---
# Fit the model

`\(H_0\)`: The number of species increases with plot biomass and pH. The effect of biomass on species number depends on pH of the soil.

--

Fit the most complex model with interaction to describe our hypothesis:


```r
mod1 &lt;- glm(Species ~ Biomass + pH + Biomass:pH, 
            data = specdat,
*           family = "poisson")
```

--

- same structure as `lm`

- add family argument to specify the error distribution
  - by default, R will pick the corresponding link function for the error distribution.
  
  - you could also be explicit about link function with `family = poisson(link = "log")`
  
  - for more information have a look at `?family`

---
# Summary table


```r
summary(mod1)
## 
## Call:
## glm(formula = Species ~ Biomass + pH + Biomass:pH, family = "poisson", 
##     data = specdat)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.4978  -0.7485  -0.0402   0.5575   3.2297  
## 
## Coefficients:
##               Estimate Std. Error z value             Pr(&gt;|z|)    
## (Intercept)    3.76812    0.06153  61.240 &lt; 0.0000000000000002 ***
## Biomass       -0.10713    0.01249  -8.577 &lt; 0.0000000000000002 ***
## pHlow         -0.81557    0.10284  -7.931  0.00000000000000218 ***
## pHmid         -0.33146    0.09217  -3.596             0.000323 ***
## Biomass:pHlow -0.15503    0.04003  -3.873             0.000108 ***
## Biomass:pHmid -0.03189    0.02308  -1.382             0.166954    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 452.346  on 89  degrees of freedom
## Residual deviance:  83.201  on 84  degrees of freedom
## AIC: 514.39
## 
## Number of Fisher Scoring iterations: 4
```

---
# Summary table

- Coefficients are on scale of link function <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> cannot be directly interpreted on the scale of the data

- For glms: deviance as measure of goodness-of-fit (for lms it was sum of squared residuals)

---
# Hypothesis tests in GLMs

- for linear models: F-tests

  - `\(F = \frac{\frac{SSR}{df(mod1)}}{\frac{SSR}{df{mod2}}}\)`
  
  - in R: `drop1(mod1, test = "F")`
  
--
  
- for generalized linear models: likelihood-ratio (LR) test

  - `\(LR = deviance(mod1) - deviance(mod2)\)`
  
  - LR follows a `\(\chi^2\)` distribution
  
  - in R: `drop1(mod1, test = "Chisq")`
  
---
# Hypothesis tests in GLMs

Test the significant of the predictors in our model with


```r
drop1(mod1, test = "Chisq")
## Single term deletions
## 
## Model:
## Species ~ Biomass + pH + Biomass:pH
##            Df Deviance    AIC   LRT  Pr(&gt;Chi)    
## &lt;none&gt;          83.201 514.39                    
## Biomass:pH  2   99.242 526.43 16.04 0.0003288 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

--

If we remove the interaction between biomass and pH from the model, the deviance increases significantly &lt;br&gt;
<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> There is a significant effect or biomass and pH on species richness.

---
# Plot the model

**Option 1: Use predict function**


```r
# step 1: creat some data to predict from
pred_dat &lt;- expand_grid(
  Biomass = seq(
    from = min(specdat$Biomass), 
    to = max(specdat$Biomass), 
    length.out = 200),
  pH = unique(specdat$pH)
)
```

--


```r
# step 2: predict species with the new data
# careful: add type = response
pred_dat$Species &lt;- predict(mod1, newdata = pred_dat, 
*                           type = "response")
```

With `type = response` we predict **on the scale of the response variable** (i.e. the data) and not on the scale of the link function

---
# Plot the model

**Option 1: Use predict function**

.pull-left[

```r
# define some colors
cols &lt;- c( "#4C7488","#D78974", "#D7BC74")

# step 3: Add model predictions to the plot
ggplot(specdat, aes(
  y = Species,
  x = Biomass,
  color = pH
)) +
  geom_point() +
* geom_line(data = pred_dat) +
  scale_color_manual(values = cols)
```

]
.pull-right[

&lt;img src="03_02_glm_files/figure-html/unnamed-chunk-11-1.png" width="504" /&gt;

]

---
# Plot the results

**Option 2: Use `geom_smooth`**

.pull-left[

```r
ggplot(specdat, aes(y = Species, x = Biomass, color = pH)) +
  geom_point() +
  geom_smooth(
*   method = "glm",
*   method.args = list(
*     family = "poisson"
    )
  )
```

- careful: `geom_smooth` always uses most complex model with all interactions
  - in this case: we want exactly that

]
.pull-right[
&lt;img src="03_02_glm_files/figure-html/unnamed-chunk-13-1.png" width="504" /&gt;
]

---
class: inverse, middle, center

# GLMs with proportion data
## Let's look at an example

---
# The data

Winter mortality of black-tailed prairie dogs

.pull-left[

**Question**:

How do

- successful mating
- achievement of a certain minimum weight before winter
- hibernation

predict the ***probability of survival &amp; death*** in winter?


]
.pull-right[
.center[![:scale 75%](img/day3/Kissing_Prairie_dog_edit_3.jpg)]
]
.footnote-right[By I, &lt;a rel="nofollow" class="external text" href="https://sites.google.com/site/thebrockeninglory/"&gt;Brocken Inaglory&lt;/a&gt;, &lt;a href="http://creativecommons.org/licenses/by-sa/3.0/" title="Creative Commons Attribution-Share Alike 3.0"&gt;CC BY-SA 3.0&lt;/a&gt;, &lt;a href="https://commons.wikimedia.org/w/index.php?curid=2542206"&gt;Link&lt;/a&gt;]

---
# The data

Winter mortality of black-tailed prairie dogs

.pull-left[


```r
pdogs
```


```
## # A tibble: 8 x 5
##   mated hibernation min.weight n.tot n.death
##   &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;
## 1 No    Yes         Yes           60       5
## 2 Yes   Yes         Yes           17       2
## 3 No    No          Yes            8       1
## # ... with 5 more rows
```

- 3 categorical predictors: `mated`, `hibernation`, `min.weight`
- total no. of animals (`n.tot`)
- number of dead animals (`n.death`)

<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> What is the response variable here?

]

.pull-right[
.center[![:scale 75%](img/day3/Kissing_Prairie_dog_edit_3.jpg)]
]

.footnote-right[By I, &lt;a rel="nofollow" class="external text" href="https://sites.google.com/site/thebrockeninglory/"&gt;Brocken Inaglory&lt;/a&gt;, &lt;a href="http://creativecommons.org/licenses/by-sa/3.0/" title="Creative Commons Attribution-Share Alike 3.0"&gt;CC BY-SA 3.0&lt;/a&gt;, &lt;a href="https://commons.wikimedia.org/w/index.php?curid=2542206"&gt;Link&lt;/a&gt;]



---
# The response variable

Winter mortality of black-tailed prairie dogs

.pull-left[

Response variable: **proportion** of surviving (or dead) animals

<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> Response has to be calculated first:


```r
pdogs &lt;- pdogs %&gt;%
  mutate(
    n.surv = n.tot - n.death,
    p.surv = n.surv / n.tot,
    p.dead = 1 - p.surv
  )
```

]

.pull-right[
.center[![:scale 75%](img/day3/Kissing_Prairie_dog_edit_3.jpg)]
]

.footnote-right[By I, &lt;a rel="nofollow" class="external text" href="https://sites.google.com/site/thebrockeninglory/"&gt;Brocken Inaglory&lt;/a&gt;, &lt;a href="http://creativecommons.org/licenses/by-sa/3.0/" title="Creative Commons Attribution-Share Alike 3.0"&gt;CC BY-SA 3.0&lt;/a&gt;, &lt;a href="https://commons.wikimedia.org/w/index.php?curid=2542206"&gt;Link&lt;/a&gt;]

---
# The response variable

The response variables (`p.dead` or `p.surv` depending on the question) are now added to the data


```
## # A tibble: 8 x 8
##   mated hibernation min.weight n.tot n.death n.surv p.surv p.dead
##   &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 No    Yes         Yes           60       5     55  0.917 0.0833
## 2 Yes   Yes         Yes           17       2     15  0.882 0.118 
## 3 No    No          Yes            8       1      7  0.875 0.125 
## 4 Yes   No          Yes            2       0      2  1     0     
## 5 No    Yes         No           187      35    152  0.813 0.187 
## # ... with 3 more rows
```

--

But what could be the problem with that?

--
<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> loss of information in proportions!

- 2 survivors / 4 total = 50% 
- 100 survivors / 200 total = 50%
**But** 100 out of 200: more information than 2 out of 4

--

<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> data points with higher total number need more weight in model fitting

---
# Fit the model

**Option 1:** Give **proportion of success** as response AND **total number** as weights


```r
mod1 &lt;- glm(
  formula = p.surv ~ ..., # choose predictors according to your hypothesis
  data = pdogs,
* family = "binomial",
* weights = n.tot
)
```

- `family = "binomial"` by default uses logit link function

---
# Fit the model

**Option 2:** Give a **table with two columns** as response:
- No of successes
- No of failures


```r
mod1 &lt;- glm(
* cbind(n.surv, n.death) ~ ...,
  data = pdogs,
* family = "binomial"
)
```

---
# Now you

---
# Additional Resources
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
