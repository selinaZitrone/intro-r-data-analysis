<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>3_Day1.knit</title>
    <meta charset="utf-8" />
    <meta name="author" content="Selina Baldauf" />
    <script src="3_Day1_files/header-attrs-2.11/header-attrs.js"></script>
    <link href="3_Day1_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/new_slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">





class: inverse title-slide
background-image: url(img/rmarkdown.png)
background-size: 30%
background-position: 90% 90%

# Reproducible Documents with `{rmarkdown}`

## Day 1

### Instructor: [Selina Baldauf](https://www.bcp.fu-berlin.de/biologie/arbeitsgruppen/botanik/ag_tietjen/People/wissenschaftliche_programmierer/baldauf/index.html) &lt;br&gt;

### Freie Universität Berlin - Theoretical Ecology

.footnote-left[
  2022-22-03 (updated: 2022-03-28)
]

---

# Topics today

- Introduction to the package

- Basic workflow

- First R Markdown document

---

# A standard workflow

.pull-left[
.center[![](img/day1/classic_workflow.png)]
]

--

.pull-right[

**Hard to answer questions:**

- How did you produced this figure? What analysis is behind it?

- Were does this value come from?

- I found an error in the raw data. Can you repeat the analysis?

]

---

# A standard workflow


.pull-left[
.center[![](img/day1/classic_workflow.png)]
]

.pull-right[


Main problem with this workflow: **error prone** and **non-reproducible** (and it can be annoying)

If you have to repeat the analysis

- Redo all figures and tables

- Update document and presentation manually
  
  - Manual copy pasting of values is very error prone
  
- You probably have to repeat this several times

]

---

# Solution: A workflow using R Markdown

**Basic idea: ** Have everything (code, text, metadata) in one place. Let `{rmarkdown}` do the magic:

  - Run code and add output
  - Return a nice document of the desired output format

.center[![:scale 60%](img/rmarkdown_wizards.png)]

.footnote-right[Artwork by [Allison Horst](https://twitter.com/allison_horst)]


---

# Motivation for using R Markdown

- **Reproducibility**

  - Easy to redo analysis
  - Easy to verify and check
  - No more copy pasting
  - Continuous workflow that is independent of the person that wrote the workflow (no clicking involved)
  
--

- Documentation/Text, Code &amp; Output in one place

--

- Use R pipeline to produce documents 
  - Create an automatic workflow
  
--

- Fun


---
# Example use cases

Any type of document, especially if it contains something produced by code

--

- Data analysis reports

  - For yourself
  - For your supervisors
  - ...
  
--
  
- Publication + Publication of analysis
  - E.g. also good for publishing code

--

- Presentations

- Websites

- Books

- ...

---

# The R Markdown universe

- Many packages that provide additional functionality
  
  - Additional output formats
  - Templates
  - Formatting tools
  - Printing tools
  - ...
  
Just some examples:

.center[![:scale 10%](img/blogdown.png)![:scale 10%](img/bookdown.png)![:scale 10%](img/pagedown.png)![:scale 10%](img/pkgdown.png)![:scale 10%](img/xaringan.png)![:scale 10%](https://camo.githubusercontent.com/84624c361fada90aed38c52d4b615339d5026988eddb96133485951e125b2eb3/68747470733a2f2f68616f7a68753233332e6769746875622e696f2f6b61626c6545787472612f6b61626c6545787472612e737667)]![](https://github.com/rstudio/rticles/blob/a1a29ec98c04642de01506f764ca9408d7be99ad/man/figures/logo.png)

There are many more ...

---

# The basic workflow

--

&lt;br&gt;

.pull-left[

1. Create an `.Rmd` document 

2. Write text and R code into the document

3. Render the document to a defined output format using `rmarkdown`
  
]

.pull-right[.center[![](img/day1/workflow_rmarkdown.png)]]

.footnote-right[Figure adapted from [BES Guides to better science: Reproducible code](https://www.britishecologicalsociety.org/wp-content/uploads/2019/06/BES-Guide-Reproducible-Code-2019.pdf)]

---
# Basic workflow in practice

**Step 1: Create a new `.Rmd` document**

- **Empty**: Create a new file in your project and save it with file ending `.Rmd`

- **From a template**:

  Rmarkdown itself comes with some templates
    - `File` -&gt; `New File` -&gt; `Rmarkdown...`
    
  Additional packages come with additional packages
    - [`{rticles}`](https://pkgs.rstudio.com/rticles/) for article templates
    - [`{xaringan}`](https://github.com/yihui/xaringan) for presentations ...
  
  
---
# Basic workflow in practice

**Step 1: Create a new `.Rmd` document**

.pull-left[
`File` -&gt; `New File` -&gt; `Rmarkdown...`

- Select template on left

- Add title and author metadata 
  - Can also be left blank and done later
  
- Select output format

- Click `OK`
]

.pull-right[
![:scale 80%](img/day1/create_document.png)
]

---
# Structure of an R Markdown document

.center[![:scale 70%](img/day1/dummy_document_basics.png)]

---
# Basic workflow in practice

**Step 2: Write your document**

--

- Metadata
- Text 
- R code

---
# Basic workflow in practice

**Step 3: Render/Knit the document to the desired output format**

--

.pull-left[

A multipstep process that is coordinated by the `{rmarkdown}` package

1. [`{knitr}`](https://yihui.org/knitr/) (an R package) runs the code and adds the output to the text

2. `knitr` creates a `.md` document

3. [Pandoc](https://pandoc.org/) (+ LaTeX) converts the markdown document to the desired output format

- Document is knitted in a new R session
  - This makes sure that the document is reproducible and that it does
  not depend on the current environment

]

.pull-right[.center[![](img/day1/workflow_rmarkdown.png)]]

---
# Basic workflow in practice

**Step 3: Render/Knit the document to the desired output format**

.pull-left[

- Click the `Knit` Button

- Use the keyboard shortcut `Ctrl/Cmd + Shift + K`
- For more options, click the little arrow next to the `Knit` button

]

.pull-right[.center[ 
 ![The options of the knit button after clicking on the little arrow next to it](img/day1/knit_button.png)]
]

&lt;br&gt;

--

<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> Iterate through steps 2 and 3 until finished

I recommend to knit often, otherwise it can become a pain to debug.

---
class: inverse, center, middle

.large[# The text body: Markdown]

---
# The text body

- Text body in Markdown syntax

- Markdown is simple markup language to create formatted text

- Rmarkdown uses pandoc's markdown syntax
  - Find a full documentation [here](https://pandoc.org/MANUAL.html#pandocs-markdown)
  
---
# The text body

**The basics**

- Bold: `**text**` becomes **text**

- Italic: `*text*` becomes *text*

--

- Subscript: `H~3~PO~4~` becomes H&lt;sub&gt;3&lt;/sub&gt;PO&lt;sub&gt;4&lt;/sub&gt;

- Superscript: `Cu^2+^` becomes Cu&lt;sup&gt;2+&lt;/sup&gt;

---
# The text body

**Code blocks**

- Inline code:  fenced of with 1 backtick becomes `code`

--

- Code blocks: fenced of with 3 backticks 

````markdown
```
code
```
````

becomes

```markdown
code
```

---
# The text body

- Links: `[text](link)`
  - `[RStudio](https://www.rstudio.com)` becomes [RStudio](https://www.rstudio.com)
  
  
---
# The text body
  
- Include image (from file/web): `![Figure caption](some/image)`
  - `![Markdown logo](https://upload.wikimedia.org/wikipedia/commons/thumb/4/48/Markdown-mark.svg/1200px-Markdown-mark.svg.png)` becomes 
  
  .center[![:scale 20%](https://upload.wikimedia.org/wikipedia/commons/thumb/4/48/Markdown-mark.svg/1200px-Markdown-mark.svg.png)
  &lt;br&gt;Markdown logo
  ]
  
--

- Footnote: `^[a footnote]`
  - Markdown logo by Dustin Curtis`^[available on [Wikimedia](https://en.wikipedia.org/wiki/Markdown#/media/File:Markdown-mark.svg)]` becomes
  - Markdown logo by Dustin Curtis&lt;sup&gt;1&lt;/sup&gt;
  
.footnote-right[

&lt;sup&gt;1&lt;/sup&gt; available on [Wikimedia](https://en.wikipedia.org/wiki/Markdown#/media/File:Markdown-mark.svg)

]

---
# The text body

**Headers**

```markdown
# First level header

## Second level header

### Third level header
```

---
# The text body

**Itemized lists**

```markdown
- item 1
  - another item
- item 2
- item 3
```

becomes

- item 1
  - another item
- item 2
- item 3

--

**Numbered lists**

```markdown
1. item 1
2. item 2
3. item 3
```

---
# The text body

**Math expressions** can be written in in LaTeX syntax

--

- Inline (enclosed with `$`)


`$f(k) = {n \choose k} p^{k} (1-p)^{n-k}$` returns `\(f(k) = {n \choose k} p^{k} (1-p)^{n-k}\)`

--

- As a separate block (enclosed with `$$`)

$$
f(k) = {n \choose k} p^{k} (1-p)^{n-k}
$$

---
# The text body


You don't need to remember all of this. [Here](https://raw.githubusercontent.com/rstudio/cheatsheets/master/rmarkdown-2.0.pdf) is a quick reference for the most important things.

--

Always use spaces around markdown objects so that they can be rendered correctly, e.g.

```markdown
## My section

This is an ordered list:

1. item 1
2. item 2
```

instead of 


```markdown
## My section
This is an ordered list:
1. item 1
2. item 2
```

---

# The text body

**Let's look at an example together**

Can you identify the formatting elements in &lt;a href="../tasks/day1/solution_docs/penguin_paper_1.html"&gt;this document&lt;/a&gt;?

---
class: inverse, middle, center

# .large[Now you]

## Task 1: Create a first docuemnt and add some text

#### Find the task description &lt;a href="../01_tasks_controller.html#first-document-and-text"&gt;here&lt;/a&gt;

---
class: inverse, center, middle

.large[# The R code]

---

# The R code

R code can be included in **code chunks** as **inline code**

--

- R code can be displayed or hidden in output document

  - Inline code is hidden
  
--
  
- Code chunks can contain any type of R code

--

- R code is (by default) executed and output is included in document
  - Text output
  - Figures
  - Prepare future data analysis
  - ...


---

# The R code

**Code chunks** starts and ends with 3 backticks

````md
```{r}
# code goes here
```
````

--

**Example**

````md
```{r}
mean(1:3)
```
````

looks like this:


```r
mean(1:3)
```

```
## [1] 2
```

---

# The R code

**Inline code** starts and ends with 1 backtick


```
## `r `
```

--

**Example**

````md
The mean of the values 1, 2 and 3 is `r mean(1:3)`
```` 

looks like this:

The mean of the values 1, 2 and 3 is 2.

---

# The R code

**Insert a code chunk**

- Insert a code chunk by going to `Code` -&gt; `Insert chunk`

- Use the keyboard shortcut `Ctrl + Alt + I` / `Cmd + Option + I`

- Inline chunks have to be typed

---
# The R code 

**Chunk names**

- Code chunks can have names (but they don't have to)

- Names are added inside the code chunk

````md
```{r calculate-mean}
mean(1:3)
```
````

--

- Easier to debug

- Code chunks appear in document outline

---

# The R code

**Run code chunk**

--

- Code chunks are evaluated by `knitr` when rendering the document

--

- Code chunks can also be run like normal R code

- Run Code chunk by clicking on the green arrow next to the chunk

![](img/day1/run_code_chunk.png)

---

# Chunk options

- Code chunks options give you fine control over the behavior of a chunk

--

- Chunk options are separated by commas

````md
```{r calculate-mean, warning=TRUE, message=TRUE}
mean(1:3)
```
````

--

- Chunk options have a `name` and a `value`

  - Chunk options have default values
  
---

# Chunk options

**Some important general options**

- `message`: `TRUE`, `FALSE`, Show message in output?

- `warning`: `TRUE`, `FALSE`, Show warning in output?

--

- `eval`: `TRUE`, `FALSE`, Evaluate the chunk?

- `echo`: `TRUE`, `FALSE`, Show source code in output?

- `include`: `TRUE`, `FALSE`, Include anything from the chunk in the output?
  - Runs the code but does not show any output or source code


---
# Chunk options

**Some important figure related options**

--

- `fig.width` and `fig.height`: Size of graphical device in inches (i.e. size of the plots)

--

- `out.width` and `out.height`: Scale output of R plots, e.g. to scale images `out.width = "80%"`

--

- `fig.align`: Plot alignment, one of `"left"`, `"center"`, `"right"`

--

- `fig.cap`: A figure caption as a string


````md
```{r important-figure, fig.cap="This is a nice plot.", fig.width=4, fig.height=4}
plot(1:10, 1:10)
```
````

---

# Chunk options

- Some chunk options can be set by clicking on the gear icon next to the chunk


![](img/day1/chunk_options_gear.png)

--

- See [here](https://yihui.org/knitr/options/) for a comprehensive list of all chunk options

---

# The setup chunk

--

- Set default chunk options in the beginning of the document

- Default options can be overwritten in individual chunks

- Default chunk options can be set via `knitr` in an R code chunk:


````md
```{r setup, inlcude=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  warning = FALSE
  )
```
````

---

# Other language engines

You can also run code chunks of other languages:



```r
names(knitr::knit_engines$get())
```

```
##  [1] "awk"         "bash"        "coffee"      "gawk"        "groovy"      "haskell"     "lein"       
##  [8] "mysql"       "node"        "octave"      "perl"        "psql"        "Rscript"     "ruby"       
## [15] "sas"         "scala"       "sed"         "sh"          "stata"       "zsh"         "asis"       
## [22] "asy"         "block"       "block2"      "bslib"       "c"           "cat"         "cc"         
## [29] "comment"     "css"         "dot"         "embed"       "fortran"     "fortran95"   "go"         
## [36] "highlight"   "js"          "julia"       "python"      "R"           "Rcpp"        "sass"       
## [43] "scss"        "sql"         "stan"        "targets"     "tikz"        "verbatim"    "theorem"    
## [50] "lemma"       "corollary"   "proposition" "conjecture"  "definition"  "example"     "exercise"   
## [57] "hypothesis"  "proof"       "remark"      "solution"
```


See [here](https://bookdown.org/yihui/rmarkdown/language-engines.html) if you are interested

---
class: inverse, middle, center

# .large[Now you]

## Task 2: Add some R code to the document

#### Find the task description &lt;a href="../01_tasks_controller.html#add-r-code"&gt;here&lt;/a&gt;

---
class: inverse, center, middle

.large[# The YAML (/ˈjæməl/) header]


---

# YAML (/ˈjæməl/) header

- YAML is a data-serialization language

- Goes between `---` on top

- Used for
  - Meta data
  - Document output formats and their options
  
- Is used by Pandoc, `rmarkdown` and `knitr`

---

# YAML (/ˈjæməl/) header

.pull-left[
**Example**

```yaml
---
title: "My first document"
author: "Selina Baldauf"
date: "3/22/2022"
output: 
  html_document:
    toc: true
    toc_float: true
bibliography: references.bib
---
```
]

--

.pull-right[
  
- YAML Syntax: Indentation is important
  - Two spaces or a tab for lists
  - Values follow a `:`

- Translation:
  - `TRUE`, `FALSE`, `NULL` become `true`, `false`, `null`
  - Strings can be quoted but don't have to (if they don't contain special characters)
  
- Can also contain inline code to be evaluated

]


---

# YAML (/ˈjæməl/) header

**Metadata**

.pull-left[
```yaml
---
title: "My first document"
subtitle: "Whatever subtitle makes sense"
author: "Selina Baldauf"
date: "`r Sys.Date()`"
---
```
]

.pull-right[

- Inline R code can print the current date at knitting time

]

---

# YAML (/ˈjæməl/) header

**Document outputs**

- `html_document`
- `pdf_document`
- `word_document`
- `beamer_presentation`
- `powerpoint_presentation`
- ...


--

To use the default version of an output format add

```yaml
output: html_document
```

or

```yaml
output:
  html_document: default
``` 

---

# YAML (/ˈjæməl/) header

**Document output options**

- Every output format has options than can be specified in the YAML header

  - Some options are shared between formats
  - Some options are specific to formats
  
--
  
- Have a look at `?rmarkdown::pdf_document`, `?rmarkdown::html_document`, etc. to see all options and their default values

- Use the [R Markdown cheat sheet](https://raw.githubusercontent.com/rstudio/cheatsheets/master/rmarkdown-2.0.pdf) as reference for the most important options

---

# YAML (/ˈjæməl/) header

**Document output options**

.pull-left[

```yaml
output: 
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
    fig_caption: true
    highlight: "espresso"
```

]
.pull-right[

- `toc`: Show table of contents?
- `toc_depth`: Lowest header level for table of contents
- `number_sections`: Should sections be numbered?
- `fig_caption`: Render figure captions?
- `highlight`: Which style to use for syntax highlighting?
  - Some options: `"kate"`, `"tango"`, `"zenburn"`

]

---
class: inverse, middle, center

# .large[Now you]

## Task 3: Change meta data and document options

#### Find the task description &lt;a href="../01_tasks_controller.html#change-yaml-header"&gt;here&lt;/a&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
